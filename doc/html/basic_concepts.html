<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>Lua-API++: Basic concepts</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="lpp_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Lua-API++
   &#160;<span id="projectnumber">2015-02-12-2</span>
   </div>
   <div id="projectbrief">Lua-API++ library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('basic_concepts.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Basic concepts </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Lua API++ is built on several basic concepts explained in this section. The namespace <a class="el" href="namespacelua.html">lua</a> is omitted from expamples.</p>
<h1><a class="anchor" id="basic_global_state"></a>
Global state</h1>
<p>The <a class="el" href="classlua_1_1_state.html">State</a> class represents a Lua context through <a href="http://en.wikipedia.org/wiki/RAII">RAII idiom</a>. Besides maintaining life-cycle of the context, <a class="el" href="classlua_1_1_state.html">State</a> object can also execute files, strings and Lua-compatible functions, which is useful for setting up the environment.</p>
<h1><a class="anchor" id="basic_state"></a>
Lua functions and context</h1>
<p>This library maintains a specific format for functions exposed to Lua:<br />
<code><a class="el" href="classlua_1_1_retval.html">Retval</a> someFunction(<a class="el" href="classlua_1_1_context.html">Context</a>&amp; context);</code><br />
Automatic stack management requires function to return specific kind of value, <a class="el" href="classlua_1_1_retval.html">Retval</a>, which can be used to return arbitrary number of values. The <a class="el" href="classlua_1_1_context.html">Context</a> object gives access to function's local and global Lua context, as well as access to most of API features that are not directly associated with <a class="el" href="basic_concepts.html#basic_values">values</a>. Through <a class="el" href="classlua_1_1_context.html">Context</a> you gain access to function's arguments, global values, registry, upvalues, garbage collector etc. It is also used for returning values and reporting errors. Function that conforms to this specification can be automatically promoted to Lua or can be explicitly wrapped into C-function via <a class="el" href="namespacelua.html#a0fb38d48b0f92faa1fb0b9cf2553ebd9">mkcf</a> function using function's name as template parameter. Normal, non-compliant C functions also can be automatically promoted or wrapped explicitly with <a class="el" href="classlua_1_1_context.html#affbac55a8c123d2b7bc7856a0b9004f5">wrap</a> function.</p>
<h2><a class="anchor" id="basic_state_multiret"></a>
Multiple return values</h2>
<h3><a class="anchor" id="basic_state_multiret_return"></a>
Returning multiple values</h3>
<p>You can return an arbitrary number of values inside <a class="el" href="classlua_1_1_retval.html">Retval</a> object created with a call to <a class="el" href="classlua_1_1_context.html#a3c8e9a2e4b05f93984c482ce00f2781a">ret</a> method of <a class="el" href="classlua_1_1_context.html">Context</a> object: </p><div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacelua.html">lua</a>;</div>
<div class="line"><a class="code" href="classlua_1_1_retval.html">Retval</a> give123(<a class="code" href="classlua_1_1_context.html">Context</a>&amp; c){</div>
<div class="line">    <span class="keywordflow">return</span> c.<a class="code" href="classlua_1_1_context.html#a3c8e9a2e4b05f93984c482ce00f2781a">ret</a>(1, 2, <span class="stringliteral">&quot;3&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p> In order to return an arbitrary number of values, accumulate them in a <a class="el" href="classlua_1_1_valset.html">Valset</a> and return it: </p><div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacelua.html">lua</a>;</div>
<div class="line"><a class="code" href="classlua_1_1_retval.html">Retval</a> makeSequence(<a class="code" href="classlua_1_1_context.html">Context</a>&amp; c){   <span class="comment">// create a sequence of natural numbers</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> amount = c.<a class="code" href="classlua_1_1_context.html#ab737cde142498f1a45ee2a2430b5e980">args</a>.<a class="code" href="classlua_1_1_valset.html#a32d5706ca851d814679ea783c05f1bbf">at</a>(0);  <span class="comment">// First argument of function is sequence size</span></div>
<div class="line">    <a class="code" href="classlua_1_1_valset.html">Valset</a> rv(c);</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keyword">auto</span> i = 1u; i &lt;= amount; ++i)</div>
<div class="line">        rv.push_back(i);</div>
<div class="line">    <span class="keywordflow">return</span> c.<a class="code" href="classlua_1_1_context.html#a3c8e9a2e4b05f93984c482ce00f2781a">ret</a>(rv);</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="basic_state_multiret_call"></a>
Accepting multiple return values of a call</h3>
<p>The results of a call can be handled in four ways: discarded completely, used as a single value, used as a sequence of values or saved in a <a class="el" href="classlua_1_1_valset.html">Valset</a> object. Using the results of a call as a single value happens in context where single value is assumed: index, assignment etc. Contexts that assume a sequence of values, such as function call parameters or returning values, will automatically expand multiple values into a subsequence. In order to store an arbitrary number of return values on Lua stack for further processing, create a <a class="el" href="classlua_1_1_valset.html">Valset</a> object by assigning call results to it: </p><div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacelua.html">lua</a>;</div>
<div class="line"><a class="code" href="classlua_1_1_retval.html">Retval</a> receiveMultiret(<a class="code" href="classlua_1_1_context.html">Context</a>&amp; c){</div>
<div class="line">    <a class="code" href="classlua_1_1_valset.html">Valset</a> results = c.<a class="code" href="classlua_1_1_context.html#a7c0195836dcfe548f10ec4db184cde4b">global</a>[<span class="stringliteral">&quot;give123&quot;</span>]();  <span class="comment">// Call global function</span></div>
<div class="line">    assert(results.<a class="code" href="classlua_1_1_valset.html#a44545a936daa510da7f9fe4835f6ee84">size</a>() == 3);</div>
<div class="line">    assert(results[1] == 2);</div>
<div class="line">    <span class="keywordflow">return</span> c.<a class="code" href="classlua_1_1_context.html#a3c8e9a2e4b05f93984c482ce00f2781a">ret</a>();</div>
<div class="line">}</div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd><a class="el" href="classlua_1_1_valset.html">Valset</a> objects are expanded just like call results, but they cannot be used as a single value.</dd></dl>
<h1><a class="anchor" id="basic_values"></a>
Lua values</h1>
<p>Lua values, as opposed to <a class="el" href="basic_concepts.html#basic_values_native">native values</a>, are values stored inside Lua state. They are handled with value-objects, which incapsulate all available operations over values. In this documentation, "value" means a value-object unless specified otherwise. Values can be indexed with <code><b>[]</b></code> and called with <code><b>()</b></code> to same effect as in Lua code, producing another value(s). Arithmetic operations (not available in Lua 5.1 compatibility mode) with value-objects is done with Lua and produces yet another value-object.<br />
Concatenation is supported with the <code><b>&amp;</b></code> operation, chain concatenations being optimized into a single operation.<br />
Comparisons of value-objects is done through Lua, but produces native boolean values.<br />
The <a class="el" href="classlua_1_1_valref.html">Valref</a> class documents all operations avaliable for value-object. Though there are <a class="el" href="basic_concepts.html#basic_values_temporary">other</a> types of value-objects, referred to as <a class="el" href="namespacelua.html#classlua_1_1_temporary">Temporary</a>, they have same interface as <a class="el" href="classlua_1_1_valref.html">Valref</a>.</p>
<h2><a class="anchor" id="basic_values_native"></a>
Native values</h2>
<p>Native values are values that are used immediately in C++ code. The library recognises several basic types as native, including <code><b>bool, int, unsigned, float, double, const char*</b></code> and <code>std::string</code>. Native values of supported types can be implicitly promoted to Lua values when used in a context that expects a Lua value: function parameters, indices, operands etc. Lua values can be converted to appropriate native type implicitly or explicitly with <a class="el" href="classlua_1_1_valref.html#a5c6a91e9b5e988939974679033c337dc">cast</a> or <a class="el" href="classlua_1_1_valref.html#a20257d4fcd278bfff897d4ffd37eb4b3">to</a> methods. This documentation refers collectively to anything that is or can be promoted to Lua value as <a class="el" href="namespacelua.html#classlua_1_1_valobj">Valobj</a>.</p>
<h2><a class="anchor" id="basic_values_user"></a>
User values</h2>
<p>Lua API++ library supports user-type handling in a minimally intrusive way. Objects of type that is bound as user-data with <a class="el" href="lua_8hpp.html#aa5b908481d9041fe334bfd1674ded658">LUAPP_USERDATA</a> macro are recognised as such and can be implicitly promoted to Lua values. Lua values can be converted to reference to user type explicitly, using <a class="el" href="classlua_1_1_valref.html#a5c6a91e9b5e988939974679033c337dc">cast</a> method.</p>
<p>Be sure to <a class="el" href="classlua_1_1_context.html#a1e702413d170d8cdc00ae9374d7664c7">assign</a> individual metatables to all userdata types when initializing environment: metatables are used to identify userdata properly. Casting to userdata without assigned metatable will always fail. When a new userdata is created, it is automatically assigned corresponding metatable.</p>
<h2><a class="anchor" id="basic_values_temporary"></a>
Temporary value handling</h2>
<p>This documentation includes numerous references to <a class="el" href="namespacelua.html#classlua_1_1_temporary">Temporary</a> type.</p>
<p>The Lua values may be stored in different places: stack, global variables, upvalues, registry etc. Even more important, they could be temporary results of some operations, which means they do not exist at all before the operation and must be discarded after use. Their creation may require yet more temporary values.</p>
<p>To handle such cases and free you from managing the stack manually, this library uses special proxy types constructed via templates. You do not need to know their exact types, because they behave just like <a class="el" href="classlua_1_1_valref.html">Valref</a>.</p>
<h2><a class="anchor" id="basic_values_valref"></a>
Valref</h2>
<p>The <a class="el" href="classlua_1_1_valref.html">Valref</a> type represents a reference to an existing <a class="el" href="basic_concepts.html#basic_values_anchors">anchor object</a>. It is safe to pass around as long as it doesn't outlive the anchor object it references.</p>
<h2><a class="anchor" id="basic_values_anchors"></a>
Anchor value types</h2>
<p>Anchor types provide permanent residence for Lua values (that is, anchor object reserves one or several stack slots for itself for as long as it exist). They "anchor" a value to the stack for future reference, hence such a name.</p>
<h3><a class="anchor" id="basic_values_anchors_value"></a>
Value</h3>
<p>The <a class="el" href="classlua_1_1_value.html">Value</a> type represents a single Lua value on the stack. This type is intended to be used to anchor result of some cumbersome operation for subsequent use without repeating that operation again. Because Value object represents more an anchor to a position in stack rather than its content, the actual value at that position can be replaced at any time with simple assignment. The only difference with <a class="el" href="basic_concepts.html#basic_values_valref">Valref</a> is that a Value object is considered a new entity and when Value object expires, the referenced slot is removed from the stack.</p>
<h3><a class="anchor" id="basic_values_anchors_table"></a>
Table</h3>
<p>The <a class="el" href="classlua_1_1_table.html">Table</a> type represents a single specific subtype of Lua value: a table. This type has reduced set of available operations, leaving only those applicable to tables, but in addition it has <a class="el" href="classlua_1_1_table.html#a5035d6acb9b556155dbf648a4f534fae">raw</a> access and allows to <a class="el" href="classlua_1_1_table.html#a74a59c576b35fccf1fba54a285d388a3">iterate</a> over the contents.</p>
<p>This type also has static functions, <a class="el" href="classlua_1_1_table.html#a5a4a30eeb0e060e041f8e52fff89ec4a">array</a> and <a class="el" href="classlua_1_1_table.html#a196b5d9f1a833e25aa4d80536f279b0a">records</a> that create filled table with the values you provide.</p>
<h3><a class="anchor" id="basic_values_anchors_valset"></a>
Valset</h3>
<p>The <a class="el" href="classlua_1_1_valset.html">Valset</a> object represents a contiguous set of values on the stack. The main purpose of this type is to hold multiple values returned from function call, also it captures the success status of protected calls. The <a class="el" href="classlua_1_1_context.html#ab737cde142498f1a45ee2a2430b5e980">arguments</a> for the function are also represented as a read-only <a class="el" href="classlua_1_1_valset.html">Valset</a> object. It is possible to grow or shrink <a class="el" href="classlua_1_1_valset.html">Valset</a> gradually in order to collect an arbitrary number of values, and returning single <a class="el" href="classlua_1_1_valset.html">Valset</a> from function is a special case: contents of the set is used directly rather than being copied. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Oct 1 2015 12:17:33 for Lua-API++ by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
